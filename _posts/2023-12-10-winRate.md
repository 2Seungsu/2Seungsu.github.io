--- 
layout: single
title: "머신러닝 - 2023 롤드컵 승부 예측"
toc: true
toc_sticky: true
toc_label: "페이지 주요 목차"

---

### 2023 롤드컵 승부 예측 
## 2023 시즌 게임지표 데이터 분석 후 타겟 생성  
## 시뮬레이션 실행 후 승리 확률 도출

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
```


```python
df = pd.read_csv('트레인데이터_정규화.csv')
```

### 트레인 테스트 나누기


```python
from sklearn.model_selection import train_test_split
```


```python
feature = df.iloc[:,:-1].to_numpy()
target = df.iloc[:,-1].to_numpy()
feature.shape, target.shape
```




    ((6480, 26), (6480,))




```python
trainX, testX, trainy, testy = train_test_split(feature, target,random_state=12,
                                               train_size=0.75, stratify=target)
```


```python
trainX.shape, trainy.shape , testX.shape, testy.shape
```




    ((4860, 26), (4860,), (1620, 26), (1620,))



### 주성분 분석


```python
from sklearn.decomposition import PCA
from sklearn.linear_model import LogisticRegression
```


```python
# PCA를 사용하여 데이터를 차원 축소합니다.
pca = PCA(n_components=7)  
pca.fit(trainX)
pca.explained_variance_ratio_
```




    array([0.63927739, 0.09648029, 0.07219958, 0.03710568, 0.03447714,
           0.02491683, 0.02056805])




```python
# 주성분 분석 결과에서 설명된 분산량 추출
pca = PCA(n_components=4)  
pca.fit(trainX)
explained_variance_ratio = pca.explained_variance_ratio_

# 설명된 분산량 및 누적 설명된 분산량 그래프 그리기
plt.figure(figsize=(8, 4))
plt.bar(range(1, len(explained_variance_ratio) + 1), explained_variance_ratio, alpha=0.7, align='center', label='Explained Variance Ratio', color='b')
plt.xlabel('Principal Components')
plt.ylabel('Explained Variance Ratio / Cumulative Explained Variance')
plt.title('Explained Variance Ratio and Cumulative Explained Variance')
plt.legend()
plt.show()
```


    
![output_10_0](https://github.com/2Seungsu/AI-BigData_curriculum/assets/141051562/32f2132c-5685-4316-b7ee-078836baea90)
    


주성분이 4개일 때 누적 설명 분산이 80% 이상이므로 주성분 4개로 분석을 진행한다.


```python
pca = PCA(n_components=4)  
pca.fit(trainX)
trainX_pca = pca.transform(trainX)
testX_pca = pca.transform(testX)
```


```python
logistic_regression = LogisticRegression()
logistic_regression.fit(trainX_pca, trainy)
```




<style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression()</pre></div></div></div></div></div>




```python
logistic_regression.score(trainX_pca, trainy)
```




    0.8411522633744856




```python
logistic_regression.score(testX_pca, testy)
```




    0.8617283950617284




```python
from sklearn.svm import SVC 
SVC_model = SVC(probability=True)
SVC_model.fit(trainX_pca, trainy)
```




<style>#sk-container-id-3 {color: black;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>SVC(probability=True)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">SVC</label><div class="sk-toggleable__content"><pre>SVC(probability=True)</pre></div></div></div></div></div>




```python
SVC_model.score(trainX_pca, trainy)
```




    0.8467078189300411




```python
SVC_model.score(testX_pca, testy)
```




    0.8641975308641975




```python
SVC_model.predict(trainX_pca)
```




    array([1., 1., 1., ..., 0., 1., 0.])




```python
SVC_model.predict_proba(trainX_pca)
```




    array([[0.10136161, 0.89863839],
           [0.15754935, 0.84245065],
           [0.04387611, 0.95612389],
           ...,
           [0.94442433, 0.05557567],
           [0.03399709, 0.96600291],
           [0.8652523 , 0.1347477 ]])




```python
from sklearn.ensemble import RandomForestRegressor
rf = RandomForestRegressor()
rf.fit(trainX, trainy)
```




<style>#sk-container-id-4 {color: black;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor()</pre></div></div></div></div></div>




```python
rf.score(testX,testy)
```




    0.8829486419753086




```python
rf.score(trainX,trainy)
```




    0.9829492181069959




```python
print(f'로지스틱  트레인 점수 : {logistic_regression.score(trainX_pca, trainy)}   테스트 점수 : {logistic_regression.score(testX_pca, testy)}')
print(f'SVM 트레인  점수 : {SVC_model.score(trainX_pca, trainy)}   테스트 점수 : {SVC_model.score(testX_pca, testy)}')
print(f'랜덤포레스트  트레인 점수 : {rf.score(trainX,trainy)}   테스트 점수 : {rf.score(testX,testy)}')
```

    로지스틱  트레인 점수 : 0.8411522633744856   테스트 점수 : 0.8617283950617284
    SVM 트레인  점수 : 0.8467078189300411   테스트 점수 : 0.8641975308641975
    랜덤포레스트  트레인 점수 : 0.9829492181069959   테스트 점수 : 0.8829486419753086
    

### 로지스틱 모형 선택 , 과적합아니고 성능이 좋고 복잡하지 않음


```python
from sklearn.metrics import classification_report
print(classification_report(testy, model1.predict(testX_pca)))
```

                  precision    recall  f1-score   support
    
             0.0       0.91      0.81      0.85       810
             1.0       0.83      0.92      0.87       810
    
        accuracy                           0.86      1620
       macro avg       0.87      0.86      0.86      1620
    weighted avg       0.87      0.86      0.86      1620
    
    


```python
from sklearn.pipeline import Pipeline
# 주성분
pca = PCA(n_components=4)
# 로지스틱 회귀 모델을 생성합니다.
logistic_regression = LogisticRegression()

# PCA와 로지스틱 회귀를 연결하는 파이프라인을 만듭니다.
pipeline = Pipeline([
    ('pca', pca),
    ('logistic', logistic_regression)
])

# 파이프라인을 학습시킵니다.
pipeline.fit(trainX, trainy)
```




<style>#sk-container-id-5 {color: black;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;pca&#x27;, PCA(n_components=4)),
                (&#x27;logistic&#x27;, LogisticRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;pca&#x27;, PCA(n_components=4)),
                (&#x27;logistic&#x27;, LogisticRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">PCA</label><div class="sk-toggleable__content"><pre>PCA(n_components=4)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression()</pre></div></div></div></div></div></div></div>




```python
# 학습된 모델을 사용하여 예측을 수행합니다.
predicted_probabilities = logistic_regression.predict_proba(trainX_pca)[:, 1].round(2)
predicted_probabilities
```




    array([0.92, 0.76, 0.94, ..., 0.  , 0.89, 0.  ])




```python
import joblib
joblib.dump(pipeline, 'pca_logistic.pkl')
```




    ['pca_logistic.pkl']



### 최적화해봤는데 그냥 적합한거랑 별 차이 없음


```python
from sklearn.model_selection import GridSearchCV
from sklearn.pipeline import Pipeline
```


```python
pipeline = Pipeline([
    ('pca', pca),
    ('logistic', logistic_regression)
])
# 파라미터 그리드 설정
param_grid = {
    'logistic__C': [0.001, 0.01, 0.1, 1, 10, 100],  
    'logistic__penalty': ['l1', 'l2','elasticnet']      
}
grid_search = GridSearchCV(pipeline, param_grid, cv=5, scoring='accuracy')
grid_search.fit(trainX, trainy)

# 최적 파라미터 확인
best_params = grid_search.best_params_
print("최적 파라미터:", best_params)
```

    최적 파라미터: {'logistic__C': 1, 'logistic__penalty': 'l2'}
    

    C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\model_selection\_validation.py:425: FitFailedWarning: 
    60 fits failed out of a total of 90.
    The score on these train-test partitions for these parameters will be set to nan.
    If these failures are not expected, you can try to debug them by setting error_score='raise'.
    
    Below are more details about the failures:
    --------------------------------------------------------------------------------
    30 fits failed with the following error:
    Traceback (most recent call last):
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\model_selection\_validation.py", line 732, in _fit_and_score
        estimator.fit(X_train, y_train, **fit_params)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\base.py", line 1151, in wrapper
        return fit_method(estimator, *args, **kwargs)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\pipeline.py", line 420, in fit
        self._final_estimator.fit(Xt, y, **fit_params_last_step)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\base.py", line 1151, in wrapper
        return fit_method(estimator, *args, **kwargs)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\linear_model\_logistic.py", line 1168, in fit
        solver = _check_solver(self.solver, self.penalty, self.dual)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\linear_model\_logistic.py", line 56, in _check_solver
        raise ValueError(
    ValueError: Solver lbfgs supports only 'l2' or 'none' penalties, got l1 penalty.
    
    --------------------------------------------------------------------------------
    30 fits failed with the following error:
    Traceback (most recent call last):
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\model_selection\_validation.py", line 732, in _fit_and_score
        estimator.fit(X_train, y_train, **fit_params)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\base.py", line 1151, in wrapper
        return fit_method(estimator, *args, **kwargs)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\pipeline.py", line 420, in fit
        self._final_estimator.fit(Xt, y, **fit_params_last_step)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\base.py", line 1151, in wrapper
        return fit_method(estimator, *args, **kwargs)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\linear_model\_logistic.py", line 1168, in fit
        solver = _check_solver(self.solver, self.penalty, self.dual)
      File "C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\linear_model\_logistic.py", line 56, in _check_solver
        raise ValueError(
    ValueError: Solver lbfgs supports only 'l2' or 'none' penalties, got elasticnet penalty.
    
      warnings.warn(some_fits_failed_message, FitFailedWarning)
    C:\Users\LG\anaconda3\envs\my_python2\lib\site-packages\sklearn\model_selection\_search.py:976: UserWarning: One or more of the test scores are non-finite: [       nan 0.83045267        nan        nan 0.83744856        nan
            nan 0.83909465        nan        nan 0.84012346        nan
            nan 0.84012346        nan        nan 0.84012346        nan]
      warnings.warn(
    


```python
# 최적 파라미터로 모델 초기화
best_model = Pipeline([
    ('pca', PCA(n_components=4)),
    ('logistic', LogisticRegression(C=best_params['logistic__C'],penalty=best_params['logistic__penalty']))
])

# 최적 모델 학습
best_model.fit(trainX, trainy)
```




<style>#sk-container-id-5 {color: black;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;pca&#x27;, PCA(n_components=4)),
                (&#x27;logistic&#x27;, LogisticRegression(C=1))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;pca&#x27;, PCA(n_components=4)),
                (&#x27;logistic&#x27;, LogisticRegression(C=1))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">PCA</label><div class="sk-toggleable__content"><pre>PCA(n_components=4)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=1)</pre></div></div></div></div></div></div></div>




```python
# 최적화 전이 성능이 더 좋음
best_model.score(trainX, trainy), best_model.score(testX, testy)
```




    (0.8411522633744856, 0.8617283950617284)



### 예측


```python
team23_ = pd.read_csv('23시즌롤드컵참가팀.csv')
team23 = team23_.copy()
```


```python
team23['Region'].fillna('NA', inplace=True)
team23['Win rate'] = team23['Win rate'].str.replace('%',"").astype(float)
team23['Game duration'] = team23['Game duration'].apply(lambda x: x.split(':')[0])
team23['Game duration'] = team23['Game duration'].astype(int)
team23.replace('-', np.nan,inplace=True)
team23 = team23.fillna(value=team23.median(axis=0), axis=0)
team23 = team23.iloc[:,4:]
team23 = team23.astype(float)
```

    C:\Users\LG\AppData\Local\Temp\ipykernel_5528\1184068917.py:6: FutureWarning: The default value of numeric_only in DataFrame.median is deprecated. In a future version, it will default to False. In addition, specifying 'numeric_only=None' is deprecated. Select only valid columns or specify the value of numeric_only to silence this warning.
      team23 = team23.fillna(value=team23.median(axis=0), axis=0)
    


```python
from sklearn.preprocessing import RobustScaler

scaler = RobustScaler()
scaled_data = scaler.fit_transform(team23)
```


```python
import joblib
model1 = joblib.load('pca_logistic.pkl')
pred_ =  model1.predict_proba(scaled_data)[:,1].round(2)
pred_
```




    array([0.77, 0.68, 0.96, 0.98, 0.97, 0.37, 0.54, 0.35, 0.88, 0.17, 0.01,
           0.46, 0.77, 0.02, 0.27, 0.58])



### 최종데이터 만들기


```python
teamDF = pd.DataFrame(scaled_data)
teamDF.columns = team23_.columns[4:]
baedang = [10, 8, 5, 13, 2.25, 501, 7, 13, 15, 26, 67,301, 81,51, 201,  101]
teamDF['baedang'] = baedang
teamDF['result'] = pred_
teamDF['Name'] = team23_.Name
teamDF
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Win rate</th>
      <th>K:D</th>
      <th>GPM</th>
      <th>GDM</th>
      <th>Game duration</th>
      <th>Kills / game</th>
      <th>Deaths / game</th>
      <th>Towers killed</th>
      <th>Towers lost</th>
      <th>FB%</th>
      <th>...</th>
      <th>NASHPG</th>
      <th>NASH%</th>
      <th>CSM</th>
      <th>DPM</th>
      <th>WPM</th>
      <th>VWPM</th>
      <th>WCPM</th>
      <th>baedang</th>
      <th>result</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.100200</td>
      <td>-0.169492</td>
      <td>0.494382</td>
      <td>0.232558</td>
      <td>0.0</td>
      <td>0.765432</td>
      <td>0.408602</td>
      <td>0.2</td>
      <td>-0.230769</td>
      <td>0.814371</td>
      <td>...</td>
      <td>0.461538</td>
      <td>-0.016484</td>
      <td>-0.115385</td>
      <td>0.058347</td>
      <td>1.75</td>
      <td>0.111111</td>
      <td>0.520548</td>
      <td>10.00</td>
      <td>0.77</td>
      <td>Bilibili Gaming</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.180361</td>
      <td>-0.576271</td>
      <td>-0.029963</td>
      <td>-0.098191</td>
      <td>0.0</td>
      <td>-0.716049</td>
      <td>-0.150538</td>
      <td>0.0</td>
      <td>-0.076923</td>
      <td>-0.251497</td>
      <td>...</td>
      <td>0.615385</td>
      <td>0.203297</td>
      <td>0.346154</td>
      <td>-0.745543</td>
      <td>0.75</td>
      <td>0.592593</td>
      <td>0.027397</td>
      <td>8.00</td>
      <td>0.68</td>
      <td>T1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.717435</td>
      <td>0.779661</td>
      <td>0.689139</td>
      <td>0.914729</td>
      <td>0.0</td>
      <td>-0.024691</td>
      <td>-1.096774</td>
      <td>1.0</td>
      <td>-0.307692</td>
      <td>1.149701</td>
      <td>...</td>
      <td>0.461538</td>
      <td>0.412088</td>
      <td>1.269231</td>
      <td>-0.719611</td>
      <td>-0.25</td>
      <td>-0.111111</td>
      <td>1.397260</td>
      <td>5.00</td>
      <td>0.96</td>
      <td>Gen.G eSports</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.533066</td>
      <td>0.881356</td>
      <td>0.119850</td>
      <td>0.263566</td>
      <td>0.0</td>
      <td>-0.567901</td>
      <td>-1.483871</td>
      <td>0.4</td>
      <td>-0.230769</td>
      <td>0.407186</td>
      <td>...</td>
      <td>-0.615385</td>
      <td>0.390110</td>
      <td>1.115385</td>
      <td>-2.003241</td>
      <td>0.25</td>
      <td>0.444444</td>
      <td>0.410959</td>
      <td>13.00</td>
      <td>0.98</td>
      <td>KT Rolster</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.190381</td>
      <td>1.084746</td>
      <td>1.198502</td>
      <td>1.266150</td>
      <td>-2.0</td>
      <td>0.814815</td>
      <td>-0.881720</td>
      <td>1.4</td>
      <td>-0.769231</td>
      <td>0.119760</td>
      <td>...</td>
      <td>-0.307692</td>
      <td>0.664835</td>
      <td>0.807692</td>
      <td>0.654781</td>
      <td>0.25</td>
      <td>-0.111111</td>
      <td>0.630137</td>
      <td>2.25</td>
      <td>0.97</td>
      <td>JD Gaming</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.653307</td>
      <td>0.169492</td>
      <td>1.123596</td>
      <td>0.563307</td>
      <td>-1.0</td>
      <td>1.308642</td>
      <td>0.408602</td>
      <td>1.0</td>
      <td>-0.153846</td>
      <td>-0.814371</td>
      <td>...</td>
      <td>-0.461538</td>
      <td>0.291209</td>
      <td>0.576923</td>
      <td>0.408428</td>
      <td>-0.25</td>
      <td>0.481481</td>
      <td>-0.465753</td>
      <td>501.00</td>
      <td>0.37</td>
      <td>GAM Esports</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.204409</td>
      <td>0.440678</td>
      <td>0.029963</td>
      <td>0.087855</td>
      <td>0.0</td>
      <td>0.419753</td>
      <td>-0.494624</td>
      <td>0.0</td>
      <td>0.230769</td>
      <td>0.970060</td>
      <td>...</td>
      <td>-0.153846</td>
      <td>0.016484</td>
      <td>-0.115385</td>
      <td>-0.116694</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7.00</td>
      <td>0.54</td>
      <td>LNG Esports</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.100200</td>
      <td>-0.237288</td>
      <td>-0.134831</td>
      <td>-0.087855</td>
      <td>-1.0</td>
      <td>-0.320988</td>
      <td>-0.279570</td>
      <td>-0.4</td>
      <td>0.153846</td>
      <td>-0.994012</td>
      <td>...</td>
      <td>-0.461538</td>
      <td>-0.291209</td>
      <td>-0.115385</td>
      <td>-1.011345</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>13.00</td>
      <td>0.35</td>
      <td>Weibo Gaming</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.140281</td>
      <td>0.372881</td>
      <td>-0.479401</td>
      <td>-0.253230</td>
      <td>0.0</td>
      <td>-0.864198</td>
      <td>-1.225806</td>
      <td>-1.2</td>
      <td>0.076923</td>
      <td>0.862275</td>
      <td>...</td>
      <td>-0.615385</td>
      <td>-0.302198</td>
      <td>0.576923</td>
      <td>-0.602917</td>
      <td>1.25</td>
      <td>1.074074</td>
      <td>0.246575</td>
      <td>15.00</td>
      <td>0.88</td>
      <td>Dplus KIA</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.685371</td>
      <td>0.474576</td>
      <td>1.288390</td>
      <td>0.945736</td>
      <td>-2.0</td>
      <td>1.753086</td>
      <td>0.322581</td>
      <td>1.2</td>
      <td>-0.307692</td>
      <td>-0.526946</td>
      <td>...</td>
      <td>0.461538</td>
      <td>0.532967</td>
      <td>-0.730769</td>
      <td>0.667747</td>
      <td>-0.25</td>
      <td>-1.074074</td>
      <td>-1.342466</td>
      <td>26.00</td>
      <td>0.17</td>
      <td>G2 Esports</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-1.118236</td>
      <td>-1.118644</td>
      <td>-0.734082</td>
      <td>-1.348837</td>
      <td>-1.0</td>
      <td>0.074074</td>
      <td>1.483871</td>
      <td>-1.4</td>
      <td>1.000000</td>
      <td>-0.467066</td>
      <td>...</td>
      <td>-2.307692</td>
      <td>-1.247253</td>
      <td>-1.038462</td>
      <td>-0.058347</td>
      <td>-0.75</td>
      <td>-0.629630</td>
      <td>-1.342466</td>
      <td>67.00</td>
      <td>0.01</td>
      <td>MAD Lions</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-0.372745</td>
      <td>-0.542373</td>
      <td>-0.823970</td>
      <td>-1.049096</td>
      <td>1.0</td>
      <td>-0.271605</td>
      <td>0.150538</td>
      <td>-0.6</td>
      <td>1.307692</td>
      <td>0.323353</td>
      <td>...</td>
      <td>1.384615</td>
      <td>-0.642857</td>
      <td>-0.423077</td>
      <td>-1.439222</td>
      <td>-0.25</td>
      <td>-0.518519</td>
      <td>-0.684932</td>
      <td>301.00</td>
      <td>0.46</td>
      <td>Team BDS</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.541082</td>
      <td>0.169492</td>
      <td>0.329588</td>
      <td>0.377261</td>
      <td>0.0</td>
      <td>0.024691</td>
      <td>-0.494624</td>
      <td>0.2</td>
      <td>-0.076923</td>
      <td>-0.119760</td>
      <td>...</td>
      <td>0.769231</td>
      <td>0.115385</td>
      <td>0.500000</td>
      <td>0.200972</td>
      <td>0.75</td>
      <td>-0.777778</td>
      <td>-0.027397</td>
      <td>81.00</td>
      <td>0.77</td>
      <td>Cloud9</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-1.030060</td>
      <td>-0.949153</td>
      <td>-0.449438</td>
      <td>-1.338501</td>
      <td>0.0</td>
      <td>-0.024691</td>
      <td>1.053763</td>
      <td>-1.8</td>
      <td>1.307692</td>
      <td>-0.383234</td>
      <td>...</td>
      <td>-0.923077</td>
      <td>-1.554945</td>
      <td>-0.423077</td>
      <td>0.252836</td>
      <td>-0.75</td>
      <td>-1.111111</td>
      <td>-1.013699</td>
      <td>51.00</td>
      <td>0.02</td>
      <td>Fnatic</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.893788</td>
      <td>-0.847458</td>
      <td>-0.329588</td>
      <td>-0.418605</td>
      <td>1.0</td>
      <td>-0.567901</td>
      <td>0.365591</td>
      <td>-0.2</td>
      <td>0.692308</td>
      <td>0.419162</td>
      <td>...</td>
      <td>0.153846</td>
      <td>-1.005495</td>
      <td>0.115385</td>
      <td>0.181524</td>
      <td>-0.25</td>
      <td>0.481481</td>
      <td>0.246575</td>
      <td>201.00</td>
      <td>0.27</td>
      <td>Team Liquid</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-0.605210</td>
      <td>-0.440678</td>
      <td>-0.659176</td>
      <td>-1.307494</td>
      <td>3.0</td>
      <td>0.567901</td>
      <td>0.666667</td>
      <td>-0.4</td>
      <td>1.230769</td>
      <td>-1.149701</td>
      <td>...</td>
      <td>4.769231</td>
      <td>-0.807692</td>
      <td>-0.884615</td>
      <td>0.337115</td>
      <td>2.75</td>
      <td>0.370370</td>
      <td>-0.794521</td>
      <td>101.00</td>
      <td>0.58</td>
      <td>NRG</td>
    </tr>
  </tbody>
</table>
<p>16 rows × 29 columns</p>
</div>




```python
meta = pd.read_csv('팀별메타챔사용횟수.csv')
meta.rename({'team':'Name'},axis=1, inplace=True)
teamStat = pd.read_csv('팀능력_전처리.csv')
teamStat.rename({'team':'Name'}, axis=1, inplace=True)
```


```python
teamDF=teamDF.merge(meta, on='Name')
teamDF=teamDF.merge(teamStat, on='Name')
teamDF.set_index('Name', inplace=True)

```


```python
teamDF.to_csv('23시즌롤드컵_최종데이터.csv', encoding='utf-8')
```

### 데이터 불러오기


```python
df = pd.read_csv('23시즌롤드컵_최종데이터.csv')
df.set_index('Name',inplace=True)
```


```python
ndf = df.iloc[:,-7:]
ndf
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>baedang</th>
      <th>result</th>
      <th>meta_pick</th>
      <th>total_pick</th>
      <th>Gold Per Minute</th>
      <th>Gold Differential per Minute</th>
      <th>Avg. Tower Difference</th>
    </tr>
    <tr>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Bilibili Gaming</th>
      <td>10.00</td>
      <td>0.77</td>
      <td>292</td>
      <td>636</td>
      <td>1901.0</td>
      <td>138.0</td>
      <td>2.6</td>
    </tr>
    <tr>
      <th>T1</th>
      <td>8.00</td>
      <td>0.68</td>
      <td>320</td>
      <td>593</td>
      <td>1869.0</td>
      <td>110.0</td>
      <td>2.4</td>
    </tr>
    <tr>
      <th>Gen.G eSports</th>
      <td>5.00</td>
      <td>0.96</td>
      <td>279</td>
      <td>557</td>
      <td>1921.0</td>
      <td>213.0</td>
      <td>3.3</td>
    </tr>
    <tr>
      <th>KT Rolster</th>
      <td>13.00</td>
      <td>0.98</td>
      <td>288</td>
      <td>546</td>
      <td>1878.0</td>
      <td>144.0</td>
      <td>2.8</td>
    </tr>
    <tr>
      <th>JD Gaming</th>
      <td>2.25</td>
      <td>0.97</td>
      <td>248</td>
      <td>515</td>
      <td>1949.0</td>
      <td>238.0</td>
      <td>3.9</td>
    </tr>
    <tr>
      <th>GAM Esports</th>
      <td>501.00</td>
      <td>0.37</td>
      <td>265</td>
      <td>482</td>
      <td>1938.0</td>
      <td>160.0</td>
      <td>2.8</td>
    </tr>
    <tr>
      <th>LNG Esports</th>
      <td>7.00</td>
      <td>0.54</td>
      <td>286</td>
      <td>491</td>
      <td>1872.0</td>
      <td>124.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Weibo Gaming</th>
      <td>13.00</td>
      <td>0.35</td>
      <td>234</td>
      <td>440</td>
      <td>1862.0</td>
      <td>108.0</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>Dplus KIA</th>
      <td>15.00</td>
      <td>0.88</td>
      <td>206</td>
      <td>397</td>
      <td>1838.0</td>
      <td>92.0</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>G2 Esports</th>
      <td>26.00</td>
      <td>0.17</td>
      <td>180</td>
      <td>344</td>
      <td>1950.0</td>
      <td>196.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>MAD Lions</th>
      <td>67.00</td>
      <td>0.01</td>
      <td>199</td>
      <td>388</td>
      <td>1822.0</td>
      <td>-12.0</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>Team BDS</th>
      <td>301.00</td>
      <td>0.46</td>
      <td>170</td>
      <td>354</td>
      <td>1809.0</td>
      <td>0.0</td>
      <td>-0.1</td>
    </tr>
    <tr>
      <th>Cloud9</th>
      <td>81.00</td>
      <td>0.77</td>
      <td>153</td>
      <td>295</td>
      <td>1885.0</td>
      <td>140.0</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>Fnatic</th>
      <td>51.00</td>
      <td>0.02</td>
      <td>179</td>
      <td>303</td>
      <td>1839.0</td>
      <td>-14.0</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>Team Liquid</th>
      <td>201.00</td>
      <td>0.27</td>
      <td>136</td>
      <td>249</td>
      <td>1838.0</td>
      <td>59.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>NRG</th>
      <td>101.00</td>
      <td>0.58</td>
      <td>130</td>
      <td>183</td>
      <td>1823.0</td>
      <td>-8.0</td>
      <td>0.6</td>
    </tr>
  </tbody>
</table>
</div>



### 1/baedang으로 도박사이트의 우승 확률


```python
ndf['baedang']=1/ndf.baedang
```

### 메타pick률 * 강팀일 확률 * 팀능력치 + 배당확률 => 예측값생성


```python
ndf['meta']= ndf['meta_pick']/ndf['total_pick']
```

### 예측


```python
# 한국,중국 1시드 -50, 마이너1시드 -200, 유럽1시드 -100, 북미 사실상1시드 -100으로 리그 독점및 불균형 값 조절
y = ndf['meta']*ndf['Gold Differential per Minute'] + (ndf['baedang']+ndf['result'])*ndf['Avg. Tower Difference'] + ndf['Gold Per Minute']
y[5]=y[5]-200
y[9]=y[9]-100
y[2]=y[2]-50
y[4]=y[4]-50
y[12]=y[12]-100
```


```python
teamName = y.index
teamName
```




    Index(['Bilibili Gaming', 'T1', 'Gen.G eSports', 'KT Rolster', 'JD Gaming',
           'GAM Esports', 'LNG Esports', 'Weibo Gaming', 'Dplus KIA', 'G2 Esports',
           'MAD Lions', 'Team BDS', 'Cloud9', 'Fnatic', 'Team Liquid', 'NRG'],
          dtype='object', name='Name')




```python
y = (y - y.mean())/y.std()
y
```




    Name
    Bilibili Gaming    0.985749
    T1                 0.452796
    Gen.G eSports      1.204314
    KT Rolster         0.843375
    JD Gaming          1.756008
    GAM Esports       -1.062367
    LNG Esports        0.677286
    Weibo Gaming       0.304829
    Dplus KIA         -0.178581
    G2 Esports         0.788628
    MAD Lions         -1.226057
    Team BDS          -1.327231
    Cloud9            -0.587041
    Fnatic            -1.008013
    Team Liquid       -0.424345
    NRG               -1.199349
    dtype: float64



### 팀별 승리 확률 출력 
#### 예시 KT Rolster


```python
teamA = []
teamB = []
for _ in range(10000):
    if  y['KT Rolster'] + np.random.randn() > y['Dplus KIA'] + np.random.randn():
        teamA.append(1)
        teamB.append(0)
    else:
        teamA.append(0)
        teamB.append(1)
```


```python
sum(teamA)/len(teamA), sum(teamB)/len(teamB)
```




    (0.7585, 0.2415)
